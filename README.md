## Simple Python Discord Bot

[![Stories in Ready][WaffleShield]][WaffleDash]

### Overview

This bot is designed to facilitate Powerplay for the federal forces.
The bot runs and monitors a discord channel and responds to commands.

### Install

This bot requires python >= 3.5. I suggest using pyenv to provide python and isolate from system.

- Install [pyenv](https://github.com/pyenv/pyenv) however you prefer
- `sudo apt-get install libsqlite-dev`
- `pyenv install 3.5.3`
- `pyenv local 3.5.3` (in project root)

Now for project dependencies.
To see actual list see setup.py, RUN_DEPS and TEST_DEPS variables.
- `sudo apt-get install python3-dev libffi-dev libczmq-dev libczmq3`
- `python setup.py deps`

NB: libczqm3 may not be available on some systems. Not to be confused with similarly named zmq kernel messaging.

To complete installation, you need to fill the data directory with configuration files.
Details forth coming, they are secret so cannot be commited.

### Running Bot

To run the main bot:

```
python -m cog.bot
```

Note that the scheduler depends on the web/app.py to be running and accepting
requests from the hooked sheets. The bot can be run without it locally, you just
won't get notified when sheet changes.

See web/app.py for more details.


### Layout

Just a brief commentary on layout/modules.
- cog: All control logic for the bot. See cog/bot.py
- cogdb: All database code. Do not hard code SQL.
- data: The data directory, contains all the configs. Do not commit secrets like your config.yml
- extras: Catchall for leftovers, also generated UML diagrams.
- tests: All test code mirrors the layout of the cog/cogdb. See conftest.py for fixtures.
- web: The simple Flask app handling POSTs lives here.

#### Setup.py

This file has some useful commands. Notably it manages the dependencies and allows the project to
be packaged for pip.

**UML Diagrams**
UML diagrams of the overall modules and class diagrams are available.
They are generated by library and dumped in extras/\*.png.
```
python setup.py uml
```

**Install Dependencies**
```
python setup.py deps
```

**Show Test Coverage**
```
python setup.py coverage
```

**Clean Project**
Note: This will remove all pyc objects, tox cache and other useless files.
```
python setup.py coverage
```

<!-- Links -->
[WaffleShield]: https://badge.waffle.io/starcraftman/cogBot.svg?label=ready&title=Ready
[WaffleDash]: http://waffle.io/starcraftman/cogBot
